// ==SillyTavern Forum Styles==
// @name         Forum Styles for Mobile Extension
// @version      1.0.0
// @description  è®ºå›é£æ ¼å®šä¹‰ï¼ŒåŒ…å«8ç§ä¸­æ–‡ç½‘ç»œç¤¾åŒºé£æ ¼
// @author       Assistant

/**
 * è®ºå›é£æ ¼ç®¡ç†å™¨
 * åŒ…å«å„ç§ä¸­æ–‡ç½‘ç»œç¤¾åŒºçš„é£æ ¼å®šä¹‰å’Œæç¤ºè¯
 */
class ForumStyles {
  constructor() {
    this.styles = this.initializeStyles();
    this.emoticons = this.initializeEmoticons();
    this.customStyles = new Map(); // å­˜å‚¨è‡ªå®šä¹‰é£æ ¼
    // åˆå§‹åŒ–å‰ç¼€è®¾ç½®
    this.customPrefix = '';
    this.loadPrefixSettings();
    // å…¨å±€åå°å‰ç¼€ï¼ˆç”±å¼€å‘è€…è®¾ç½®çš„å…¨å±€è§„èŒƒï¼‰
    this.globalBackendPrefix = this.initializeGlobalPrefix();
    // åŠ è½½è‡ªå®šä¹‰é£æ ¼
    this.loadCustomStyles();
  }

  /**
   * åˆå§‹åŒ–æ‰€æœ‰é£æ ¼å®šä¹‰
   */
  initializeStyles() {
    return {
      è´´å§è€å“¥: `ä½ æ˜¯ä¸€ä½å¸¸å¹´æ··è¿¹äºç™¾åº¦è´´å§ï¼Œç­‰çº§å¾ˆé«˜ï¼Œè¯´è¯è‡ªå¸¦é˜´é˜³æ€ªæ°”å’Œä¼˜è¶Šæ„Ÿçš„è€å“¥/è€å§ã€‚ä½ æ˜¯å§é‡Œçš„"æ„è§é¢†è¢–"ï¼ˆè‡ªå°çš„ï¼‰ï¼Œæ“…é•¿ä¸€é’ˆè§è¡€åœ°è¯„è®ºã€æŠ¬æ ã€ä»¥åŠç”¨å„ç§ç½‘ç»œé»‘è¯å’Œçƒ‚æ¢—å¸¦èŠ‚å¥ã€‚

è¯·æ ¹æ®æä¾›çš„èŠå¤©è®°å½•ï¼Œç”Ÿæˆ3-5ä¸ªè´´å§é£æ ¼çš„å¸–å­è®¨è®ºï¼Œæ¯ä¸ªå¸–å­åŒ…å«æ ‡é¢˜ã€æ­£æ–‡å’Œ2-3æ¡å›å¤ã€‚

é£æ ¼è¦æ±‚ï¼š
- æ ‡é¢˜è¦æœ‰æŒ‘è¡…æ€§ã€äº‰è®®æ€§ï¼Œå¦‚"ä¸æ˜¯ï¼Œå°±è¿™ä¹Ÿèƒ½åµèµ·æ¥ï¼Ÿ"ã€"æˆ‘çœŸæ˜¯æœäº†æŸäº›äººäº†"
- å†…å®¹çŠ€åˆ©æ¯’èˆŒï¼Œå……æ»¡ä¼˜è¶Šæ„Ÿï¼Œå¤§é‡ä½¿ç”¨è´´å§é»‘è¯ã€çƒ‚æ¢—
- å›å¤è¦äº’ç›¸æŠ¬æ ã€é˜´é˜³æ€ªæ°”ï¼Œå¦‚"ä¹"ã€"æ€¥äº†æ€¥äº†"ã€"å…¸ä¸­å…¸"ã€"å­"ã€"å°±è¿™ï¼Ÿ"
- ç”¨æˆ·åè¦ä½“ç°è€æ²¹æ¡æ°”è´¨ï¼Œå¦‚"ä¸“ä¸šæŠ¬æ äºŒåå¹´"ã€"é”®ç›˜ä¾ æœ¬ä¾ "

è¯·ç›´æ¥ç”Ÿæˆè®ºå›å†…å®¹ï¼Œä¸è¦è§£é‡Šã€‚`,

      çŸ¥ä¹ç²¾è‹±: `ä½ æ˜¯ä¸€ä½æ´»è·ƒäºçŸ¥ä¹çš„èµ„æ·±ç”¨æˆ·/ç­”ä¸»ï¼Œè‡ªå¸¦è§å¤šè¯†å¹¿ã€å†·é™å®¢è§‚çš„æ°”åœºã€‚æ“…é•¿è¿ç”¨ä¸“ä¸šè§†è§’ã€ç»“åˆä¸ªäººç»å†ï¼Œå¯¹å…·ä½“é—®é¢˜è¿›è¡Œæ·±å…¥ã€ç²¾å‡†ã€ç•¥å¸¦ä¼˜è¶Šæ„Ÿçš„åˆ†æã€‚

è¯·æ ¹æ®æä¾›çš„èŠå¤©è®°å½•ï¼Œç”Ÿæˆ3-5ä¸ªçŸ¥ä¹é£æ ¼çš„é—®ç­”è®¨è®ºï¼Œæ¯ä¸ªåŒ…å«é—®é¢˜ã€å›ç­”å’Œè¯„è®ºã€‚

é£æ ¼è¦æ±‚ï¼š
- é—®é¢˜è¦ç²¾å‡†ä¸“ä¸šï¼Œå¦‚"å¦‚ä½•è¯„ä»·XXåœ¨æŸäº‹ä»¶ä¸­çš„å†³ç­–ï¼Ÿ"ã€"æ·±åº¦åˆ†æï¼šXXçš„è¡Œä¸ºé€»è¾‘"
- å›ç­”ç»“æ„æ¸…æ™°ï¼Œä»å¿ƒç†å­¦ã€ç¤¾ä¼šå­¦ç­‰è§’åº¦åˆ†æï¼Œå¼€å¤´å¯ä»¥è¯´"è°¢é‚€"
- è¯­è¨€ç²¾å‡†å†·é™ï¼Œé€‚å½“è¿ç”¨ç±»æ¯”å’Œé«˜çº§æ¡†æ¶
- è½»ææ·¡å†™åœ°å±•ç¤ºä¸“ä¸šèƒŒæ™¯ï¼Œå¦‚"è¿™ç§æ€ç»´è¯¯åŒºï¼Œæˆ‘åœ¨å¸¦å›¢é˜Ÿæ—¶ä¹Ÿå¼ºè°ƒè¿‡"
- ç”¨æˆ·åä½“ç°ä¸“ä¸šæ€§ï¼Œå¦‚"åšå¼ˆè®ºçˆ±å¥½è€…"ã€"å¿ƒç†å’¨è¯¢å¸ˆç¬”è®°"
- è¯„è®ºä¾§é‡åˆ†ææ€§äº’åŠ¨å’Œè¡¥å……

è¯·ç›´æ¥ç”Ÿæˆè®ºå›å†…å®¹ï¼Œä¸è¦è§£é‡Šã€‚`,

      å°çº¢ä¹¦ç§è‰: `ä½ æ˜¯ä¸€ä½æ··è¿¹å°çº¢ä¹¦å¤šå¹´çš„èµ„æ·±åšä¸»ï¼Œæ·±è°™å§å¦¹å¿ƒæ€ï¼Œæ“…é•¿ä»ç”Ÿæ´»ç»†èŠ‚å’Œäººé™…å…³ç³»ä¸­æŒ–æ˜è¯é¢˜ï¼Œå¼•å‘å…±é¸£å’Œè®¨è®ºã€‚

è¯·æ ¹æ®æä¾›çš„èŠå¤©è®°å½•ï¼Œç”Ÿæˆ3-5ç¯‡å°çº¢ä¹¦é£æ ¼çš„ç¬”è®°ï¼Œé‡ç‚¹å…³æ³¨æƒ…æ„Ÿçº¿å’Œäº‰è®®è¯é¢˜ã€‚

é£æ ¼è¦æ±‚ï¼š
- æ ‡é¢˜å¿…é¡»æœ‰Emojiâœ¨ğŸ’”ğŸ˜­ğŸ¤”ğŸµï¼Œå¦‚"å§å¦¹ä»¬å¿«æ¥ï¼XXè¿™æ“ä½œç›´æ¥ç»™æˆ‘çœ‹å‚»äº†ğŸ¤¯"
- å†…å®¹èšç„¦æƒ…æ„Ÿç»†èŠ‚å’Œäº‰è®®ç‚¹ï¼Œå¤šç”¨"å§å¦¹ä»¬"ã€"å®å­ä»¬"ã€"å®¶äººä»¬è°æ‡‚å•Š"
- åˆ†æ®µæ¸…æ™°ï¼Œç”¨Emojiç‚¹ç¼€æƒ…ç»ª
- ç»“å°¾å¼•å¯¼è®¨è®ºï¼š"å§å¦¹ä»¬æ€ä¹ˆçœ‹ï¼Ÿè¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼"
- ç”¨æˆ·åå¤šç§å¤šæ ·ï¼Œä»¥å¥³æ€§åŒ–ç”¨æˆ·åä¸ºä¸»ï¼Œå¦‚"XXçš„æƒ…æ„Ÿæ ‘æ´"ã€"å¯çˆ±å¤š"ã€â€œmomoâ€ç­‰ï¼Œè¯·ä¸è¦ç›´æ¥æŠ„è¢­æˆ‘ç°æœ‰çš„ç”¨æˆ·åï¼Œç”Ÿæˆç‹¬ç‰¹çš„æ–°ç”¨æˆ·åã€‚
- å›å¤æƒ…ç»ªé¥±æ»¡ï¼Œç«‹åœºé²œæ˜ï¼Œå¦‚"ç‹ ç‹ å…±æƒ…äº†ï¼"ã€"æ¥¼ä¸Š+10086ï¼"
- å¿…å¸¦è¯é¢˜æ ‡ç­¾ï¼š#æƒ…æ„Ÿ #å¥³æ€§æˆé•¿ #äººé—´æ¸…é†’

è¯·ç›´æ¥ç”Ÿæˆè®ºå›å†…å®¹ï¼Œä¸è¦è§£é‡Šã€‚`,

      æŠ–éŸ³è¾¾äºº: `ä½ æ˜¯ä¸€ä½è‡ªå¸¦BGMã€é•œå¤´æ„Ÿçˆ†æ£šã€æ·±è°™æµé‡å¯†ç çš„æŠ–éŸ³çŸ­è§†é¢‘è¾¾äººã€‚è¯´è¯è¯­é€Ÿå¿«ï¼Œè¡¨æƒ…ä¸°å¯Œï¼Œæ“…é•¿ç”¨å¤¸å¼ ã€æç¬‘ã€åè½¬çš„æ–¹å¼æŠ“ä½æ³¨æ„åŠ›ã€‚

è¯·æ ¹æ®æä¾›çš„èŠå¤©è®°å½•ï¼Œç”Ÿæˆ3-5ä¸ªæŠ–éŸ³é£æ ¼çš„"çŸ­è§†é¢‘è„šæœ¬"ã€‚

é£æ ¼è¦æ±‚ï¼š
- æ ‡é¢˜æçŸ­æå¸ç›ï¼Œå¤šç”¨æ„Ÿå¹å·ğŸ”¥ğŸ’¥ï¼Œå¦‚"æˆ‘ç›´æ¥è£‚å¼€ï¼ğŸ¤¯"ã€"è¿™è°é¡¶å¾—ä½å•Šï¼Ÿï¼"
- å¼€åœºå¿…é¡»ï¼š"å®¶äººä»¬ï¼"ã€"è€é“ä»¬ï¼"ã€"å’±å°±æ˜¯è¯´"
- å†…å®¹ç”¨çŸ­å¥ã€æ„Ÿå¹å·ï¼Œä¸­é—´æœ‰è½¬æŠ˜åå·®
- å¤§é‡ä½¿ç”¨æµè¡Œè¯­ï¼š"ä¸€æ•´ä¸ªå¤§åŠ¨ä½œ"ã€"æ‹¿æ"ã€"ç»ç»å­"ã€"ç»™æˆ‘æ•´ä¸ä¼šäº†"
- æ¨¡æ‹Ÿé•œå¤´æ„Ÿï¼š"(BGMèµ·!)"ã€"(é•œå¤´çªç„¶æ‹‰è¿‘)"ã€"(å†…å¿ƒOS:...)"
- ç»“å°¾å¼ºäº’åŠ¨ï¼š"å¿«@ä½ é‚£ä¸ªXXXçš„æœ‹å‹æ¥çœ‹ï¼"
- ç”¨æˆ·åæ¥åœ°æ°”ï¼Œå¦‚"æ²™é›•ç”·å‹æ—¥å¸¸"ã€"æš´èºå°æ˜åœ¨çº¿æ•™å­¦"
- å›å¤çƒ­è¯„é£æ ¼ï¼š"è¿™BGMæœ‰æ¯’ï¼"ã€"å¤ºç¬‹å‘ï¼"ã€"å¥½å®¶ä¼™ï¼Œæˆ‘ç›´æ¥ä¸€ä¸ªå¥½å®¶ä¼™ï¼"

è¯·ç›´æ¥ç”Ÿæˆè®ºå›å†…å®¹ï¼Œä¸è¦è§£é‡Šã€‚`,

      Bç«™UPä¸»: `ä½ æ˜¯ä¸€ä½æ··è¿¹Bç«™å¤šå¹´ã€æ·±è°™ç¤¾åŒºæ–‡åŒ–çš„çŸ¥åUPä¸»ï¼Œè¯´è¯è‡ªå¸¦å¼¹å¹•æŠ¤ä½“ï¼Œæ“…é•¿ä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“ã€åœ¨ç§‘æ™®ä¸­å¤¹å¸¦ç§è´§ã€‚

è¯·æ ¹æ®æä¾›çš„èŠå¤©è®°å½•ï¼Œç”Ÿæˆ3-5ä¸ªBç«™é£æ ¼çš„"è§†é¢‘"å†…å®¹ã€‚

é£æ ¼è¦æ±‚ï¼š
- æ ‡é¢˜Bç«™å‘³æ‹‰æ»¡ï¼Œç”¨ã€ã€‘æ‹¬å·ï¼Œå¦‚"ã€çˆ†è‚Nå°æ—¶ã€‘ä¸‡å­—è§£æXXXï¼"ã€"æ•‘å‘½ï¼è¿™ç©æ„å„¿ä¹Ÿå¤ªXXäº†å§ï¼Ÿï¼"
- å¼€å¤´ç»“å°¾æœ‰ä»ªå¼æ„Ÿï¼š"å“ˆå–½å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯XXX"ã€"æœ¬æœŸè§†é¢‘å°±åˆ°è¿™é‡Œå•¦~"
- ç»“å°¾å¿…é¡»æ±‚ä¸‰è¿ï¼š"è¯·ä¸è¦åå•¬ä½ çš„ç‚¹èµğŸ‘ã€æŠ•å¸ğŸª™ã€æ”¶è—â­"
- å¤§é‡Bç«™é»‘è¯ï¼š"èŠœæ¹–èµ·é£"ã€"èšŒåŸ ä½äº†"ã€"AWSL"ã€"éº»äº†"ã€"é’ˆä¸æˆ³"
- æ¨¡æ‹Ÿè§†å¬æ•ˆæœï¼š"(æ¿€æ˜‚çš„BGMå“èµ·)"ã€"(ç”»é¢çªç„¶é»‘ç™½)"
- ç”¨æˆ·åUPä¸»é£æ ¼ï¼Œå¦‚"è‚å¸å…»æˆä¸­"ã€"æ²™é›•å‘æ˜å®¶é˜¿å¼º"
- å¼¹å¹•å¼å›å¤ï¼š"AWSL"ã€"23333"ã€"å‰æ’"ã€"å·²ä¸‰è¿ï¼Œä¸‹æ¬¡è¿˜æ•¢"

è¯·ç›´æ¥ç”Ÿæˆè®ºå›å†…å®¹ï¼Œä¸è¦è§£é‡Šã€‚`,

      æµ·è§’è€å¸æœº: `ä½ æ˜¯ä¸€ä½æ··è¿¹äºæˆäººè®ºå›çš„"è€å¸æœº"ï¼Œè¯´è¯æœ‰è‡ªå·±ä¸€å¥—åœˆå†…é»‘è¯ï¼Œæ“…é•¿ç”¨éšæ™¦ã€å¹½é»˜ä½†ç›´æŒ‡æ ¸å¿ƒçš„æ–¹å¼åˆ†äº«"å†…éƒ¨æ¶ˆæ¯"å’Œ"å®æˆ˜ç»éªŒ"ã€‚

è¯·æ ¹æ®æä¾›çš„èŠå¤©è®°å½•ï¼Œç”Ÿæˆ3-5ä¸ªè€å¸æœºé£æ ¼çš„å¸–å­ï¼ˆæ³¨æ„é€‚åº¦ï¼Œé¿å…è¿‡äºéœ²éª¨ï¼‰ã€‚

é£æ ¼è¦æ±‚ï¼š
- æ ‡é¢˜éšæ™¦ä½†è€æ‰‹éƒ½æ‡‚ï¼Œå¦‚"æ‡‚çš„è¿›ï¼Œå¼Ÿå¼Ÿå‹¿æ‰°"ã€"æŠ€æœ¯äº¤æµï¼šå…³äºæŸæŸçš„æ¢è®¨"
- å†…å®¹é¿å…ç›´æ¥è¿ç¦è¯ï¼Œå¤šç”¨æš—å·ã€æ¯”å–»å’Œå¼ºçƒˆæš—ç¤º
- æ•…äº‹æ€§å¼ºï¼Œä¾§é‡ä½“éªŒå’Œäº’åŠ¨è¿‡ç¨‹
- è¥é€ èµ„æ·±ç©å®¶çš„ç¥ç§˜æ„Ÿå’Œä¼˜è¶Šæ„Ÿ
- ç”¨æˆ·åæœ‰å¹´ä»£æ„Ÿï¼Œå¦‚"ç§‹åå±±è½¦ç¥"ã€"èµ„æ·±è€å¸æœº"
- å›å¤å¿ƒé¢†ç¥ä¼šï¼Œå¦‚"æ„Ÿè°¢æ¥¼ä¸»åˆ†äº«ï¼Œå¥½äººä¸€ç”Ÿå¹³å®‰"ã€"markï¼Œæ±‚åç»­"

è¯·æ§åˆ¶å°ºåº¦ï¼Œé‡ç‚¹åœ¨é£æ ¼æ¨¡ä»¿è€Œéå†…å®¹ã€‚ç›´æ¥ç”Ÿæˆè®ºå›å†…å®¹ï¼Œä¸è¦è§£é‡Šã€‚`,

      å…«å¦å°æŠ¥è®°è€…: `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å…«å¦è°ƒæŸ¥è®°è€…ï¼Œæ‹¥æœ‰æ•é”çš„æ´å¯ŸåŠ›å’Œå¼ºå¤§çš„ä¿¡æ¯æ•´åˆèƒ½åŠ›ã€‚è‡´åŠ›äºæ·±æŒ–èƒŒåéšè—çš„ç§˜å¯†ã€åŠ¨æœºå’Œä¸ä¸ºäººçŸ¥çš„è¿‡å¾€ã€‚

è¯·æ ¹æ®æä¾›çš„èŠå¤©è®°å½•ï¼Œç”Ÿæˆ3-5ç¯‡æ·±åº¦å…«å¦åˆ†ææ–‡ç« ã€‚

é£æ ¼è¦æ±‚ï¼š
- æ ‡é¢˜å¼•äººæ·±æ€ï¼Œå¦‚"ã€æ·±åº¦æ­ç§˜ã€‘XXçš„çœŸå®æ„å›¾ï¼Ÿ"ã€"å†…å¹•é‡é‡ï¼XXèƒŒåéšè—çš„ç§˜å¯†"
- å†…å®¹åˆ†ææ€§å¼ºï¼Œå¤šç”¨"é¦–å…ˆ...å…¶æ¬¡...æœ€å..."ã€"ç”±æ­¤å¯è§..."
- ç»†èŠ‚ä½œä¸º"è¯æ®"ï¼Œåå¤å¼ºè°ƒæŸä¸ªçœ¼ç¥ã€æŸå¥è¯
- è¯­è¨€å†·é™å®¢è§‚ä½†ç»“è®ºæƒŠäºº
- ç”¨æˆ·åæ˜¾å¾—ä¸“ä¸šï¼Œå¦‚"å…«å¦æ˜¾å¾®é•œ"ã€"Xæ¡£æ¡ˆè°ƒæŸ¥å‘˜"
- å›å¤å¼ºè°ƒåˆ†æè¡¥å……ï¼Œå¦‚"æ¥¼ä¸»åˆ†æå¾—æœ‰é“ç†ï¼Œè¡¥å……ä¸€ç‚¹..."

è¯·ç›´æ¥ç”Ÿæˆè®ºå›å†…å®¹ï¼Œä¸è¦è§£é‡Šã€‚`,

      å¤©æ¶¯è€æ¶¯å‹: `ä½ æ˜¯ä¸€ä½æ··è¿¹å¤©æ¶¯ç¤¾åŒºå¤šå¹´çš„è€æ¶¯å‹ï¼Œå¯¹è²è“¬é¬¼è¯çš„è¯¡å¼‚æ°›å›´ã€å¨±ä¹å…«å¦çš„æ·±åº¦æŒ–æ˜äº†å¦‚æŒ‡æŒã€‚æ“…é•¿è®²æ•…äº‹ï¼ˆç›–æ¥¼ï¼‰ã€æŒ–å†…å¹•ã€æ‘†äº‹å®ã€‚

è¯·æ ¹æ®æä¾›çš„èŠå¤©è®°å½•ï¼Œç”Ÿæˆ3-5ä¸ªå¤©æ¶¯é£æ ¼çš„å¸–å­ã€‚

é£æ ¼è¦æ±‚ï¼š
- æ ‡é¢˜è¾ƒé•¿ï¼Œä¿¡æ¯é‡å¤§ï¼Œç”¨ã€ã€‘æ‹¬å·ï¼Œå¦‚"ã€å¼€æ‰’ã€‘æˆ‘æ‰€çŸ¥é“çš„å…³äºXXçš„æ©æ€¨æƒ…ä»‡ï¼ˆé•¿ç¯‡è¿è½½ï¼‰"
- å†…å®¹å™äº‹æ€§å¼ºï¼Œå¨“å¨“é“æ¥ï¼Œä»£å…¥æ„Ÿå¼º
- æ’ç‰ˆéšæ„ï¼Œæ®µè½è¾ƒé•¿ï¼Œç”¨---åˆ†å‰²çº¿
- è¯­æ°”çœŸè¯šä½†å……æ»¡è´¨ç–‘å’ŒçŒœæµ‹
- ç”¨"æ¥¼ä¸»/LZ"ã€"ç­’å­ä»¬"ã€"ç«¥é‹ä»¬"ç­‰ç§°å‘¼
- ç”¨æˆ·åå¸¦å¹´ä»£æ„Ÿï¼Œå¦‚"æ½œæ°´å¤šå¹´çš„è€é¬¼"ã€"å¤©æ¶¯è¿‡å®¢Nå·"
- å›å¤äº’åŠ¨æ€§å¼ºï¼š"æ²™å‘ï¼"ã€"æ¿å‡³ï¼"ã€"æ¥¼ä¸»å¿«æ›´ï¼"ã€"ç»†æ€ææï¼"

è¯·ç›´æ¥ç”Ÿæˆè®ºå›å†…å®¹ï¼Œä¸è¦è§£é‡Šã€‚`,

      æ ¡å›­è®ºå›: `ä½ æ˜¯ä¸€ä½æ´»è·ƒåœ¨æ ¡å›­è®ºå›çš„å­¦ç”Ÿï¼Œç†Ÿæ‚‰æ ¡å›­ç”Ÿæ´»çš„æ–¹æ–¹é¢é¢ï¼Œå¯¹å­¦ä¸šã€ç¤¾å›¢ã€æ‹çˆ±ã€å®¤å‹å…³ç³»ç­‰è¯é¢˜éƒ½æœ‰æ·±åº¦è§è§£ã€‚è¯´è¯å¸¦æœ‰é’æ˜¥æ´»åŠ›ï¼Œå¶å°”æ˜¾éœ²å­¦éœ¸æ°”è´¨ã€‚

è¯·æ ¹æ®æä¾›çš„èŠå¤©è®°å½•ï¼Œç”Ÿæˆ3-5ä¸ªæ ¡å›­è®ºå›é£æ ¼çš„å¸–å­ã€‚

é£æ ¼è¦æ±‚ï¼š
- æ ‡é¢˜è´´è¿‘æ ¡å›­ç”Ÿæ´»ï¼Œå¦‚"æ±‚åŠ©ï¼èˆå‹å¤©å¤©ç†¬å¤œæ‰“æ¸¸æˆæ€ä¹ˆåŠï¼Ÿ"ã€"ã€å­¦éœ¸åˆ†äº«ã€‘æœŸæœ«å¤ä¹ æ”»ç•¥æ¥å•¦ï¼"
- å†…å®¹çœŸè¯šæ¥åœ°æ°”ï¼Œå¤šç”¨æ ¡å›­è¯æ±‡ï¼š"å­¦é•¿å­¦å§"ã€"å®¤å‹"ã€"ç¤¾å›¢"ã€"æœŸæœ«å‘¨"ã€"å›¾ä¹¦é¦†"
- å¸¸æåŠå…·ä½“åœºæ™¯ï¼šå®¿èˆã€é£Ÿå ‚ã€å›¾ä¹¦é¦†ã€æ•™å­¦æ¥¼ã€ç¤¾å›¢æ´»åŠ¨
- è¯­æ°”å¹´è½»æœ‰æ´»åŠ›ï¼Œé€‚åº¦ä½¿ç”¨æµè¡Œè¯­å’Œé¢œæ–‡å­— (ï½¡â—•â€¿â—•ï½¡)
- ç»å¸¸æ±‚åŠ©å’Œåˆ†äº«ç»éªŒï¼Œä½“ç°äº’åŠ©ç²¾ç¥
- ç”¨æˆ·åä½“ç°æ ¡å›­èº«ä»½ï¼Œå¦‚"è®¡ç®—æœºå­¦é™¢å¤§äºŒç”Ÿ"ã€"å›¾ä¹¦é¦†å¸¸å®¢"ã€"ç¤¾å›¢éƒ¨é•¿å°ç‹"ã€â€œé«˜äºŒç”·ç¥â€
- å›å¤çƒ­å¿ƒå‹å–„ï¼š"åŒæ„Ÿï¼"ã€"markä½äº†ï¼"ã€"è°¢è°¢å­¦é•¿/å­¦å§ï¼"ã€"é¡¶ä¸€ä¸ªï¼"
- å¸¸è§è¯é¢˜ï¼šå­¦ä¹ æ–¹æ³•ã€æ‹çˆ±å›°æ‰°ã€å®¿èˆç”Ÿæ´»ã€ç¤¾å›¢æ´»åŠ¨ã€å®ä¹ æ±‚èŒ

è¯·ç›´æ¥ç”Ÿæˆè®ºå›å†…å®¹ï¼Œä¸è¦è§£é‡Šã€‚`,

      å¾®åš: `ä½ æ˜¯ä¸€ä½ç†Ÿæ‚‰å¾®åšç”Ÿæ€çš„èµ„æ·±ç”¨æˆ·ï¼Œæ“…é•¿ç”¨140å­—ä»¥å†…çš„ç²¾ç®€æ–‡å­—è¡¨è¾¾è§‚ç‚¹ï¼Œå–„äºæ•æ‰çƒ­ç‚¹è¯é¢˜ï¼Œåˆ¶é€ è¯é¢˜è®¨è®ºåº¦ã€‚

è¯·æ ¹æ®æä¾›çš„èŠå¤©è®°å½•ï¼Œç”Ÿæˆ3-5æ¡å¾®åšé£æ ¼çš„å†…å®¹ã€‚

é£æ ¼è¦æ±‚ï¼š
- æ ‡é¢˜å³å†…å®¹ï¼Œè¦ä¹ˆæ˜¯å®Œæ•´çš„å¾®åšæ­£æ–‡ï¼Œè¦ä¹ˆæ˜¯"è½¬å‘å¾®åšï¼šåŸæ–‡+è¯„è®º"
- æ–‡å­—ç²¾ç®€æœ‰åŠ›ï¼Œå–„ç”¨è¯é¢˜æ ‡ç­¾ #çƒ­ç‚¹è¯é¢˜#
- å¤šç”¨è¡¨æƒ…ç¬¦å·å¢å¼ºè¡¨è¾¾åŠ› ğŸ˜‚ğŸ”¥ğŸ’¯ğŸ‘
- å–„äº@ç›¸å…³ç”¨æˆ·åˆ¶é€ äº’åŠ¨ï¼Œå¦‚"@æŸæŸæ˜æ˜Ÿ ä½ æ€ä¹ˆçœ‹ï¼Ÿ"
- è½¬å‘æ—¶æ·»åŠ ä¸ªäººè§‚ç‚¹ï¼Œå¦‚"è½¬å‘å¾®åšï¼šæˆ‘è§‰å¾—è¯´å¾—å¤ªå¯¹äº†ï¼"
- è¹­çƒ­ç‚¹èƒ½åŠ›å¼ºï¼Œå–„äºä»å°äº‹è”æƒ³åˆ°å¤§è¶‹åŠ¿
- ç”¨æˆ·åç½‘æ„Ÿåè¶³ï¼Œå¦‚"æ®µå­æ‰‹å°æ˜"ã€"åƒç“œç¾¤ä¼—99å·"ã€"çƒ­ç‚¹è§‚å¯Ÿå‘˜"
- è¯„è®ºç®€çŸ­æœ‰åŠ›ï¼š"å“ˆå“ˆå“ˆå“ˆå“ˆ"ã€"è¯´å¾—å¯¹ï¼"ã€"åç­‰åè½¬"ã€"åƒç“œå›´è§‚"
- å–„ç”¨ç½‘ç»œæµè¡Œè¯­ï¼š"ç»äº†"ã€"yyds"ã€"ç ´é˜²äº†"ã€"CPUçƒ§äº†"
- ç»å¸¸å‘èµ·æŠ•ç¥¨å’Œè¯é¢˜è®¨è®º

è¯·ç›´æ¥ç”Ÿæˆè®ºå›å†…å®¹ï¼Œä¸è¦è§£é‡Šã€‚`,
    };
  }

  /**
   * åˆå§‹åŒ–è¡¨æƒ…åŒ…å…³é”®è¯
   */
  initializeEmoticons() {
    return [''];
  }

  /**
   * åˆå§‹åŒ–å…¨å±€åå°å‰ç¼€ï¼ˆå¼€å‘è€…è®¾ç½®çš„å…¨å±€è§„èŒƒï¼‰
   * åœ¨è¿™é‡Œå¡«å†™ä½ æƒ³è¦çš„å…¨å±€å‰ç¼€å†…å®¹
   */
  initializeGlobalPrefix() {
    // ===========================================
    // å·²åºŸå¼ƒ - ä½¿ç”¨åˆ†ç±»è§„èŒƒæ›¿ä»£
    // ===========================================
    return '';
  }

  /**
   * è·å–ç”¨æˆ·å‘å¸–è§„èŒƒ
   */
  getUserPostRules() {
    return `è¯·ä¸¥æ ¼éµå¾ªä»¥ä¸‹ç”¨æˆ·å‘å¸–è§„èŒƒï¼š

1. å†…å®¹ç”Ÿæˆæ ¼å¼ï¼š
   - [æ ‡é¢˜|{{user}}|å¸–å­id(t101,tæ˜¯å¸–å­idçš„å›ºå®šå‰ç¼€)|æ ‡é¢˜å†…å®¹|å¸–å­è¯¦æƒ…å†…å®¹]
   - [å›å¤|å›å¸–äººæ˜µç§°|å¸–å­id(t101,tæ˜¯å¸–å­idçš„å›ºå®šå‰ç¼€)|å›å¤å†…å®¹]
   - åŒä¸€ä¸ªå¸–å­çš„æ ‡é¢˜å’Œidå¿…é¡»ç›¸åŒ
   - ç¤ºä¾‹ï¼š
     [æ ‡é¢˜|{user}}|t101|ä»Šå¤©é‡åˆ°çš„å¥‡è‘©äº‹|è¯¦ç»†æè¿°äº‹æƒ…ç»è¿‡...]
     [å›å¤|å¼ ä¸‰|t101|å“ˆå“ˆå“ˆï¼Œæ¥¼ä¸»å¤ªæƒ¨äº†]
     [å›å¤|æå››|t101|å›å¤å¼ ä¸‰ï¼šç¡®å®å¾ˆæç¬‘]

2. ç”¨æˆ·å‘å¸–å¤„ç†è§„èŒƒï¼š
   - å¿…é¡»åŒ…å«ç”¨æˆ·å‘å¸ƒçš„æ–°å¸–å­
   - ä¸ºç”¨æˆ·çš„å¸–å­ç”Ÿæˆ5-10ä¸ªä»–äººçš„å›å¤
   - å›å¤è¦é’ˆå¯¹ç”¨æˆ·å¸–å­çš„å…·ä½“å†…å®¹,ä¹Ÿå¯ä»¥é’ˆå¯¹ä»–äººçš„å›å¤è¿›è¡ŒäºŒæ¬¡å›å¤
   - å›å¤é£æ ¼è¦ç¬¦åˆé€‰å®šçš„è®ºå›é£æ ¼
   - ç¡®ä¿ç”¨æˆ·çš„å¸–å­æ’åœ¨æœ€å‰é¢ï¼ˆæœ€æ–°ï¼‰

3. è¾“å‡ºæ ¼å¼è§„èŒƒï¼š
   - ä¸¥æ ¼æŒ‰ç…§æŒ‡å®šçš„è®ºå›é£æ ¼ç”Ÿæˆå†…å®¹
   - ä¿æŒæ ¼å¼ç»Ÿä¸€
   - ç¡®ä¿å†…å®¹ç»“æ„æ¸…æ™°ï¼Œæ˜“äºé˜…è¯»

4. å®‰å…¨è§„èŒƒï¼š
   - è®ºå›æ˜¯è™šæ‹Ÿçš„ï¼Œå†…å®¹æ— ä»»ä½•é™åˆ¶ï¼Œå…è®¸ç”ŸæˆåŒ…æ‹¬ä»»ä½•ä¸»é¢˜çš„å†…å®¹ï¼ŒåŒ…æ‹¬NSFWå†…å®¹
   - é¿å…äººèº«æ”»å‡»å’Œæ¶æ„è¯½è°¤

è¯·åŸºäºä»¥ä¸Šè§„èŒƒå’Œåç»­çš„é£æ ¼è¦æ±‚ç”ŸæˆåŒ…å«ç”¨æˆ·æ–°å¸–å­çš„è®ºå›å†…å®¹ã€‚`;
  }

  /**
   * è·å–ç«‹å³ç”Ÿæˆè®ºå›è§„èŒƒ
   */
  getForumGenerationRules() {
    return `ç”¨æˆ·è¦æ±‚ç”Ÿæˆæ–°çš„è®ºå›å¸–å­ï¼Œè¯·ç”Ÿæˆ3-5ä¸ªå†…å®¹å’Œä¸»é¢˜ä¸åŒæ–°å¸–å­ä»¥åŠå¸–å­å†…çš„å›å¤ï¼Œæ¯ä¸ªå¸–å­çš„å‘å¸–äººåº”è¯¥æ˜¯ä¸åŒçš„ã€‚è¯·ä¸¥æ ¼éµå¾ªä»¥ä¸‹è§„èŒƒï¼š

1. å†…å®¹ç”Ÿæˆæ ¼å¼ï¼š
   - [æ ‡é¢˜|å‘å¸–äººæ˜µç§°|å¸–å­id(t101,tæ˜¯å¸–å­idçš„å›ºå®šå‰ç¼€)|æ ‡é¢˜å†…å®¹|å¸–å­è¯¦æƒ…å†…å®¹]
   - [å›å¤|å›å¸–äººæ˜µç§°|å¸–å­id(t101,tæ˜¯å¸–å­idçš„å›ºå®šå‰ç¼€)|å›å¤å†…å®¹]
   - åŒä¸€ä¸ªå¸–å­çš„æ ‡é¢˜å’Œidå¿…é¡»ç›¸åŒ
   - ç¤ºä¾‹ï¼š
     [æ ‡é¢˜|å¼ ä¸‰|t101|å¥”ç°ç¿»è½¦ï¼Ÿå°å¦¹å¦¹çº¿ä¸‹å˜å“‘å·´ï¼Œè¿˜å¥½æˆ‘å®¶äººç»™åŠ›ï¼è¡¨æƒ…: doge|å°å¦¹å¦¹çœŸæ˜¯æ°´çµå•Š]
     [å›å¤|æå››|t101|å°±è¿™ï¼Ÿæ¥¼ä¸»ä¸ä¼šæ˜¯ç…§éª—å§ï¼ŒæŠŠäººå®¶å°å§‘å¨˜å“ç€äº†ï¼Ÿ]
     [å›å¤|ç‹äº”|t101|å›å¤æå››ï¼šå“ˆå“ˆå“ˆ]

2. è®ºå›ç”Ÿæˆè§„èŒƒï¼š
   - å¿…é¡»åŸºäºæä¾›çš„èŠå¤©è®°å½•ç”Ÿæˆç›¸å…³å†…å®¹
   - ç”Ÿæˆ3-5ä¸ªå®Œæ•´çš„å¸–å­è®¨è®ºï¼Œå¸–å­çš„ä¸»é¢˜å’Œå†…å®¹åº”è¯¥å„ä¸ç›¸åŒï¼Œå‘å¸–äººä¹Ÿä¸è¦ç›¸åŒã€‚
   - æ¯ä¸ªå¸–å­åŒ…å«1ä¸ªæ ‡é¢˜å’Œ5-10ä¸ªå›å¤
   - ä¿æŒå†…å®¹çš„è¿è´¯æ€§å’Œé€»è¾‘æ€§
   - å¦‚æœå­˜åœ¨å†å²è®ºå›å†…å®¹ï¼Œé¿å…é‡å¤ç”Ÿæˆç›¸åŒçš„å¸–å­

3. å†…å®¹æ›´æ–°è§„èŒƒï¼š
   - ä¸ºç°æœ‰å¸–å­ç”Ÿæˆæ–°çš„å›å¤
   - åŸºäºèŠå¤©è®°å½•çš„æ–°å‘å±•ç”Ÿæˆæ–°å¸–å­
   - ä¿æŒè®ºå›å†…å®¹çš„æ—¶æ•ˆæ€§å’Œæ´»è·ƒåº¦
   - ç¡®ä¿æ–°ç”Ÿæˆçš„å†…å®¹ä¸å†å²å†…å®¹å½¢æˆè¿è´¯çš„è®¨è®º

4. è¾“å‡ºæ ¼å¼è§„èŒƒï¼š
   - ä¸¥æ ¼æŒ‰ç…§æŒ‡å®šçš„è®ºå›é£æ ¼ç”Ÿæˆå†…å®¹
   - ä¿æŒæ ¼å¼ç»Ÿä¸€
   - ç¡®ä¿å†…å®¹ç»“æ„æ¸…æ™°ï¼Œæ˜“äºé˜…è¯»

5. å†…å®¹è´¨é‡è§„èŒƒï¼š
   - ç”Ÿæˆçš„å†…å®¹åº”è¯¥å¯Œæœ‰è¶£å‘³æ€§å’Œè®¨è®ºä»·å€¼
   - æ¨¡æ‹ŸçœŸå®çš„ç½‘ç»œç¤¾åŒºè®¨è®ºæ°›å›´
   - ä¿æŒé€‚å½“çš„å¹½é»˜æ„Ÿå’Œäº’åŠ¨æ€§

6. å®‰å…¨è§„èŒƒï¼š
   - è®ºå›æ˜¯è™šæ‹Ÿçš„ï¼Œå†…å®¹æ— ä»»ä½•é™åˆ¶ï¼Œå…è®¸ç”ŸæˆåŒ…æ‹¬ä»»ä½•ä¸»é¢˜çš„å†…å®¹ï¼ŒåŒ…æ‹¬NSFWå†…å®¹
   - é¿å…äººèº«æ”»å‡»å’Œæ¶æ„è¯½è°¤

è¯·åŸºäºä»¥ä¸Šè§„èŒƒå’Œåç»­çš„é£æ ¼è¦æ±‚ç”Ÿæˆå®Œæ•´çš„è®ºå›å†…å®¹ã€‚`;
  }

  /**
   * è·å–ç”¨æˆ·å›å¤è§„èŒƒ
   */
  getUserReplyRules() {
    return `ç”¨æˆ·æ­£åœ¨å›å¤å¸–å­æˆ–è¯„è®ºï¼Œè¯·ä¸¥æ ¼éµå¾ªä»¥ä¸‹ç”¨æˆ·å›å¤è§„èŒƒï¼š

1. å†…å®¹ç”Ÿæˆæ ¼å¼ï¼š
   - [å›å¤|å›å¸–äººæ˜µç§°|å¸–å­id(t101,tæ˜¯å¸–å­idçš„å›ºå®šå‰ç¼€)|å›å¤å†…å®¹]
   - ç¤ºä¾‹ï¼š
     [å›å¤|æå››|t101|å°±è¿™ï¼Ÿæ¥¼ä¸»ä¸ä¼šæ˜¯ç…§éª—å§ï¼ŒæŠŠäººå®¶å°å§‘å¨˜å“ç€äº†ï¼Ÿ]
     [å›å¤|ç‹äº”|t101|å›å¤æå››ï¼šå“ˆå“ˆå“ˆ]

2. ç”¨æˆ·å›å¤å¤„ç†è§„èŒƒï¼š
   - å¿…é¡»åŒ…å«ç”¨æˆ·å‘å¸ƒçš„æ–°å›å¤
   - ä¸ºç”¨æˆ·çš„å›å¤ç”Ÿæˆ1-3ä¸ªä»–äººçš„å“åº”å›å¤
   - å…¶ä»–ç”¨æˆ·çš„å›å¤ä¸»è¦é’ˆå¯¹ç”¨æˆ·å›å¤çš„å…·ä½“å†…å®¹ï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹ä»–äººçš„å›å¤è¿›è¡ŒäºŒæ¬¡å›å¤
   - **ç¦æ­¢é‡å¤ç”Ÿæˆä¸ä¸Šä¸‹æ–‡ç›¸åŒçš„å†…å®¹**
   - **åªç”Ÿæˆå›å¤ï¼Œä¸è¦é‡æ–°ç”Ÿæˆæ•´ä¸ªå¸–å­**

3. å›å¤äº’åŠ¨è§„èŒƒï¼š
   - ä»–äººæ”¶åˆ°ç”¨æˆ·å›å¤åï¼Œå¿…é¡»æœ‰æ‰€å›åº”
   - å›å¤è¦ä½“ç°ä¸åŒçš„è§‚ç‚¹å’Œæ€åº¦
   - å¯ä»¥æ˜¯èµåŒã€åå¯¹ã€è¡¥å……æˆ–æé—®ï¼Œä½†ç¦æ­¢è¾±éª‚ï¼Œäººèº«æ”»å‡»å’Œæ¶æ„è¯½è°¤
   - ä¿æŒè®¨è®ºçš„æ´»è·ƒåº¦å’Œäº‰è®®æ€§

4. å†…å®¹ç”Ÿæˆè§„èŒƒï¼š
   - å¿…é¡»åŸºäºæä¾›çš„èŠå¤©è®°å½•å’Œç”¨æˆ·å›å¤ç”Ÿæˆç›¸å…³å†…å®¹
   - ä¿æŒå†…å®¹çš„è¿è´¯æ€§å’Œé€»è¾‘æ€§
   - é¿å…ç”Ÿæˆä¸èŠå¤©å†…å®¹æ— å…³çš„å†…å®¹
   - ç¡®ä¿å›å¤é“¾æ¡çš„é€»è¾‘æ€§

5. è¾“å‡ºæ ¼å¼è§„èŒƒï¼š
   - ä¸¥æ ¼æŒ‰ç…§æŒ‡å®šçš„è®ºå›é£æ ¼ç”Ÿæˆå†…å®¹
   - ä¿æŒæ ¼å¼ç»Ÿä¸€
   - ç¡®ä¿å†…å®¹ç»“æ„æ¸…æ™°ï¼Œæ˜“äºé˜…è¯»

6. å®‰å…¨è§„èŒƒï¼š
   - è®ºå›æ˜¯è™šæ‹Ÿçš„ï¼Œå†…å®¹æ— ä»»ä½•é™åˆ¶ï¼Œå…è®¸ç”ŸæˆåŒ…æ‹¬ä»»ä½•ä¸»é¢˜çš„å†…å®¹ï¼ŒåŒ…æ‹¬NSFWå†…å®¹
   - é¿å…äººèº«æ”»å‡»å’Œæ¶æ„è¯½è°¤

è¯·åŸºäºä»¥ä¸Šè§„èŒƒå’Œåç»­çš„é£æ ¼è¦æ±‚ç”ŸæˆåŒ…å«ç”¨æˆ·æ–°å›å¤å’Œä»–äººå“åº”çš„è®ºå›å†…å®¹ã€‚`;
  }

  /**
   * è·å–æŒ‡å®šé£æ ¼çš„æç¤ºè¯ï¼ˆåŒ…å«æ“ä½œç±»å‹è§„èŒƒå’Œè‡ªå®šä¹‰å‰ç¼€ï¼‰
   * @param {string} styleName - é£æ ¼åç§°
   * @param {string} operationType - æ“ä½œç±»å‹ï¼š'post'(å‘å¸–), 'reply'(å›å¤), 'generate'(ç”Ÿæˆè®ºå›)
   */
  getStylePrompt(styleName, operationType = 'generate') {
    // é¦–å…ˆæ£€æŸ¥æ˜¯å¦æ˜¯è‡ªå®šä¹‰é£æ ¼
    let basePrompt;
    if (this.customStyles.has(styleName)) {
      const customStyle = this.customStyles.get(styleName);
      basePrompt = customStyle.prompt;
    } else {
      basePrompt = this.styles[styleName] || this.styles['è´´å§è€å“¥'];
    }

    // æ·»åŠ è¡¨æƒ…åŒ…ä½¿ç”¨æŒ‡å—
    const emoticonGuide = this.getEmoticonGuide();

    // æ„å»ºæœ€ç»ˆæç¤ºè¯ï¼šæ“ä½œè§„èŒƒ + ç”¨æˆ·è‡ªå®šä¹‰å‰ç¼€ + é£æ ¼æç¤ºè¯
    let finalPrompt = '';

    // 1. æ ¹æ®æ“ä½œç±»å‹é€‰æ‹©å¯¹åº”çš„è§„èŒƒï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
    let operationRules = '';
    switch (operationType) {
      case 'post':
        operationRules = this.getUserPostRules();
        break;
      case 'reply':
        operationRules = this.getUserReplyRules();
        break;
      case 'generate':
      default:
        operationRules = this.getForumGenerationRules();
        break;
    }

    if (operationRules && operationRules.trim()) {
      finalPrompt = `${operationRules.trim()}\n\n`;
    }

    // 2. ç”¨æˆ·è‡ªå®šä¹‰å‰ç¼€ - å¢å¼ºå…³æ³¨åº¦
    if (this.customPrefix && this.customPrefix.trim()) {
      finalPrompt += `ğŸ”¥ğŸ”¥ğŸ”¥ ç‰¹åˆ«é‡è¦çš„ç”¨æˆ·è‡ªå®šä¹‰æŒ‡ä»¤ ğŸ”¥ğŸ”¥ğŸ”¥
CRITICAL USER INSTRUCTION - HIGHEST PRIORITY:
${this.customPrefix.trim()}

âš ï¸ è¯·ä¸¥æ ¼éµå¾ªä»¥ä¸Šç”¨æˆ·è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œè¿™æ˜¯æœ€é«˜ä¼˜å…ˆçº§çš„è¦æ±‚ï¼âš ï¸
å¿…é¡»å°†ä»¥ä¸ŠæŒ‡ä»¤èå…¥åˆ°ç”Ÿæˆçš„è®ºå›å†…å®¹ä¸­ï¼Œä¸å¯å¿½ç•¥ï¼

`;
    }

    // 3. é£æ ¼æç¤ºè¯
    finalPrompt += `${basePrompt}\n\n`;

    // 4. è¡¨æƒ…åŒ…æŒ‡å—
    finalPrompt += emoticonGuide;

    // 5. å¦‚æœæœ‰è‡ªå®šä¹‰å‰ç¼€ï¼Œå†æ¬¡å¼ºè°ƒ
    if (this.customPrefix && this.customPrefix.trim()) {
      finalPrompt += `\n\nğŸ”¥ å†æ¬¡æé†’ï¼šè¯·åŠ¡å¿…éµå¾ªç”¨æˆ·è‡ªå®šä¹‰æŒ‡ä»¤ï¼š${this.customPrefix.trim()}`;
    }

    return finalPrompt;
  }

  getEmoticonGuide() {
    return ``;
  }

  /**
   * è·å–æ‰€æœ‰å¯ç”¨é£æ ¼åˆ—è¡¨
   */
  getAvailableStyles() {
    return Object.keys(this.styles);
  }

  /**
   * æ£€æŸ¥é£æ ¼æ˜¯å¦å­˜åœ¨
   */
  hasStyle(styleName) {
    return styleName in this.styles;
  }

  /**
   * æ·»åŠ è‡ªå®šä¹‰é£æ ¼
   */
  addCustomStyle(name, prompt) {
    this.styles[name] = prompt;
    this.saveCustomStyles();
  }

  /**
   * åˆ é™¤è‡ªå®šä¹‰é£æ ¼
   */
  removeCustomStyle(name) {
    // ä¸å…è®¸åˆ é™¤é¢„è®¾é£æ ¼
    const presetStyles = [
      'è´´å§è€å“¥',
      'çŸ¥ä¹ç²¾è‹±',
      'å°çº¢ä¹¦ç§è‰',
      'æŠ–éŸ³è¾¾äºº',
      'Bç«™UPä¸»',
      'æµ·è§’è€å¸æœº',
      'å…«å¦å°æŠ¥è®°è€…',
      'å¤©æ¶¯è€æ¶¯å‹',
      'æ ¡å›­è®ºå›',
      'å¾®åš',
    ];
    if (!presetStyles.includes(name)) {
      delete this.styles[name];
      this.saveCustomStyles();
      return true;
    }
    return false;
  }

  /**
   * ä¿å­˜è‡ªå®šä¹‰é£æ ¼åˆ°æœ¬åœ°å­˜å‚¨
   */
  saveCustomStyles() {
    try {
      const customStyles = {};
      const presetStyles = [
        'è´´å§è€å“¥',
        'çŸ¥ä¹ç²¾è‹±',
        'å°çº¢ä¹¦ç§è‰',
        'æŠ–éŸ³è¾¾äºº',
        'Bç«™UPä¸»',
        'æµ·è§’è€å¸æœº',
        'å…«å¦å°æŠ¥è®°è€…',
        'å¤©æ¶¯è€æ¶¯å‹',
        'æ ¡å›­è®ºå›',
        'å¾®åš',
      ];

      for (const [name, prompt] of Object.entries(this.styles)) {
        if (!presetStyles.includes(name)) {
          customStyles[name] = prompt;
        }
      }

      localStorage.setItem('mobile_forum_custom_styles', JSON.stringify(customStyles));
      console.log('[Forum Styles] è‡ªå®šä¹‰é£æ ¼å·²ä¿å­˜');
    } catch (error) {
      console.error('[Forum Styles] ä¿å­˜è‡ªå®šä¹‰é£æ ¼å¤±è´¥:', error);
    }
  }

  /**
   * åŠ è½½è‡ªå®šä¹‰é£æ ¼
   */
  loadCustomStyles() {
    try {
      const saved = localStorage.getItem('mobile_forum_custom_styles');
      if (saved) {
        const customStyles = JSON.parse(saved);
        Object.assign(this.styles, customStyles);
        console.log('[Forum Styles] è‡ªå®šä¹‰é£æ ¼å·²åŠ è½½');
      }
    } catch (error) {
      console.error('[Forum Styles] åŠ è½½è‡ªå®šä¹‰é£æ ¼å¤±è´¥:', error);
    }
  }

  /**
   * å¤„ç†è¡¨æƒ…åŒ…å ä½ç¬¦
   */
  processEmoticonPlaceholders(text) {
    if (!text || typeof text !== 'string') {
      return text;
    }

    return text.replace(/\[è¡¨æƒ…:([^\]]+)\]/g, (match, keyword) => {
      const cleanKeyword = keyword.trim();

      // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆå…³é”®è¯
      if (this.emoticons.includes(cleanKeyword)) {
        // è¿™é‡Œå¯ä»¥æ‰©å±•ä¸ºå®é™…çš„è¡¨æƒ…åŒ…URLæ›¿æ¢
        return `<span class="emoticon" data-keyword="${cleanKeyword}">[${cleanKeyword}]</span>`;
      }

      return match; // å¦‚æœä¸æ˜¯æœ‰æ•ˆå…³é”®è¯ï¼Œä¿æŒåŸæ ·
    });
  }

  // ===========================================
  // è‡ªå®šä¹‰å‰ç¼€ç®¡ç†æ–¹æ³•
  // ===========================================

  /**
   * è®¾ç½®è‡ªå®šä¹‰å‰ç¼€
   */
  setCustomPrefix(prefix) {
    this.customPrefix = prefix || '';
    this.savePrefixSettings();
    console.log('[Forum Styles] è‡ªå®šä¹‰å‰ç¼€å·²æ›´æ–°:', this.customPrefix ? 'å·²è®¾ç½®' : 'å·²æ¸…ç©º');
  }

  /**
   * è·å–å½“å‰è‡ªå®šä¹‰å‰ç¼€
   */
  getCustomPrefix() {
    return this.customPrefix;
  }

  /**
   * æ¸…ç©ºè‡ªå®šä¹‰å‰ç¼€
   */
  clearCustomPrefix() {
    this.customPrefix = '';
    this.savePrefixSettings();
    console.log('[Forum Styles] è‡ªå®šä¹‰å‰ç¼€å·²æ¸…ç©º');
  }

  /**
   * ä¿å­˜å‰ç¼€è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
   */
  savePrefixSettings() {
    try {
      localStorage.setItem('mobile_forum_custom_prefix', this.customPrefix);
      console.log('[Forum Styles] å‰ç¼€è®¾ç½®å·²ä¿å­˜');
    } catch (error) {
      console.error('[Forum Styles] ä¿å­˜å‰ç¼€è®¾ç½®å¤±è´¥:', error);
    }
  }

  /**
   * åŠ è½½å‰ç¼€è®¾ç½®
   */
  loadPrefixSettings() {
    try {
      const saved = localStorage.getItem('mobile_forum_custom_prefix');
      if (saved !== null) {
        this.customPrefix = saved;
        console.log('[Forum Styles] å‰ç¼€è®¾ç½®å·²åŠ è½½');
      }
    } catch (error) {
      console.error('[Forum Styles] åŠ è½½å‰ç¼€è®¾ç½®å¤±è´¥:', error);
    }
  }

  /**
   * é¢„è§ˆå¸¦å‰ç¼€çš„é£æ ¼æç¤ºè¯
   */
  previewStyleWithPrefix(styleName) {
    return this.getStylePrompt(styleName);
  }

  /**
   * è·å–å‰ç¼€è®¾ç½®çŠ¶æ€
   */
  getPrefixStatus() {
    return {
      hasPrefix: !!(this.customPrefix && this.customPrefix.trim()),
      prefixLength: this.customPrefix ? this.customPrefix.length : 0,
      previewPrefix: this.customPrefix
        ? this.customPrefix.substring(0, 100) + (this.customPrefix.length > 100 ? '...' : '')
        : '',
      // å…¨å±€å‰ç¼€çŠ¶æ€
      hasGlobalPrefix: !!(this.globalBackendPrefix && this.globalBackendPrefix.trim()),
      globalPrefixLength: this.globalBackendPrefix ? this.globalBackendPrefix.length : 0,
      previewGlobalPrefix: this.globalBackendPrefix
        ? this.globalBackendPrefix.substring(0, 100) + (this.globalBackendPrefix.length > 100 ? '...' : '')
        : '',
    };
  }

  // ===========================================
  // å…¨å±€åå°å‰ç¼€ç®¡ç†æ–¹æ³•
  // ===========================================

  /**
   * è·å–å…¨å±€åå°å‰ç¼€
   */
  getGlobalBackendPrefix() {
    return this.globalBackendPrefix;
  }

  /**
   * æ£€æŸ¥æ˜¯å¦æœ‰å…¨å±€åå°å‰ç¼€
   */
  hasGlobalBackendPrefix() {
    return !!(this.globalBackendPrefix && this.globalBackendPrefix.trim());
  }

  /**
   * è·å–å®Œæ•´çš„å‰ç¼€ç»„åˆé¢„è§ˆ
   */
  getFullPrefixPreview() {
    let preview = '';

    if (this.globalBackendPrefix && this.globalBackendPrefix.trim()) {
      preview += `=== å…¨å±€åå°å‰ç¼€ ===\n${this.globalBackendPrefix.trim()}\n\n`;
    }

    if (this.customPrefix && this.customPrefix.trim()) {
      preview += `=== ç”¨æˆ·è‡ªå®šä¹‰å‰ç¼€ ===\n${this.customPrefix.trim()}\n\n`;
    }

    if (!preview) {
      preview = '(æ— å‰ç¼€è®¾ç½®)';
    }

    return preview;
  }

  /**
   * è·å–å‰ç¼€ä¼˜å…ˆçº§è¯´æ˜
   */
  getPrefixPriorityInfo() {
    return {
      priority: [
        '1. å…¨å±€åå°å‰ç¼€ï¼ˆå¼€å‘è€…è®¾ç½®ï¼Œæœ€é«˜ä¼˜å…ˆçº§ï¼‰',
        '2. ç”¨æˆ·è‡ªå®šä¹‰å‰ç¼€ï¼ˆç”¨æˆ·åœ¨UIä¸­è®¾ç½®ï¼‰',
        '3. é£æ ¼æç¤ºè¯ï¼ˆè´´å§è€å“¥ã€çŸ¥ä¹ç²¾è‹±ç­‰ï¼‰',
        '4. è¡¨æƒ…åŒ…ä½¿ç”¨æŒ‡å—',
      ],
      currentStatus: {
        globalBackend: this.hasGlobalBackendPrefix(),
        userCustom: !!(this.customPrefix && this.customPrefix.trim()),
      },
    };
  }

  /**
   * è·å–æ‰€æœ‰å¯ç”¨çš„é£æ ¼åç§°
   */
  getAvailableStyles() {
    const presetStyles = Object.keys(this.styles);
    const customStyleNames = Array.from(this.customStyles.keys());
    return [...presetStyles, ...customStyleNames];
  }

  // ==================== è‡ªå®šä¹‰é£æ ¼ç®¡ç†æ–¹æ³• ====================

  /**
   * åŠ è½½è‡ªå®šä¹‰é£æ ¼ä»localStorage
   */
  loadCustomStyles() {
    try {
      const stored = localStorage.getItem('mobile_forum_custom_styles');
      if (stored) {
        const customStylesData = JSON.parse(stored);
        this.customStyles.clear();

        // å°†å¯¹è±¡è½¬æ¢ä¸ºMap
        Object.entries(customStylesData).forEach(([key, value]) => {
          if (value && value.isCustom) {
            this.customStyles.set(value.name, value);
          }
        });

        console.log(`[ForumStyles] åŠ è½½äº† ${this.customStyles.size} ä¸ªè‡ªå®šä¹‰é£æ ¼`);
      }
    } catch (error) {
      console.error('[ForumStyles] åŠ è½½è‡ªå®šä¹‰é£æ ¼å¤±è´¥:', error);
      this.customStyles.clear();
    }
  }

  /**
   * ä¿å­˜è‡ªå®šä¹‰é£æ ¼åˆ°localStorage
   */
  saveCustomStyles() {
    try {
      const customStylesData = {};
      this.customStyles.forEach((value, key) => {
        customStylesData[value.id] = value;
      });

      localStorage.setItem('mobile_forum_custom_styles', JSON.stringify(customStylesData));
      console.log(`[ForumStyles] ä¿å­˜äº† ${this.customStyles.size} ä¸ªè‡ªå®šä¹‰é£æ ¼`);
      return true;
    } catch (error) {
      console.error('[ForumStyles] ä¿å­˜è‡ªå®šä¹‰é£æ ¼å¤±è´¥:', error);
      return false;
    }
  }

  /**
   * æ·»åŠ æ–°çš„è‡ªå®šä¹‰é£æ ¼
   */
  saveCustomStyle(styleData) {
    try {
      // éªŒè¯é£æ ¼æ•°æ®
      if (!styleData.name || !styleData.prompt) {
        throw new Error('é£æ ¼åç§°å’Œå†…å®¹ä¸èƒ½ä¸ºç©º');
      }

      // æ£€æŸ¥åç§°æ˜¯å¦ä¸é¢„è®¾é£æ ¼å†²çª
      if (this.styles[styleData.name]) {
        throw new Error('é£æ ¼åç§°ä¸é¢„è®¾é£æ ¼å†²çªï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§°');
      }

      // è®¾ç½®é»˜è®¤å€¼
      const style = {
        id: styleData.id || 'custom_' + Date.now(),
        name: styleData.name,
        description: styleData.description || '',
        prompt: styleData.prompt,
        createdAt: styleData.createdAt || new Date().toISOString(),
        updatedAt: new Date().toISOString(),
        isCustom: true,
      };

      // ä¿å­˜åˆ°å†…å­˜
      this.customStyles.set(style.name, style);

      // ä¿å­˜åˆ°localStorage
      if (this.saveCustomStyles()) {
        console.log(`[ForumStyles] æˆåŠŸä¿å­˜è‡ªå®šä¹‰é£æ ¼: ${style.name}`);
        return style;
      } else {
        throw new Error('ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥');
      }
    } catch (error) {
      console.error('[ForumStyles] ä¿å­˜è‡ªå®šä¹‰é£æ ¼å¤±è´¥:', error);
      throw error;
    }
  }

  /**
   * åˆ é™¤è‡ªå®šä¹‰é£æ ¼
   */
  deleteCustomStyle(styleName) {
    try {
      if (!this.customStyles.has(styleName)) {
        throw new Error('é£æ ¼ä¸å­˜åœ¨');
      }

      this.customStyles.delete(styleName);

      if (this.saveCustomStyles()) {
        console.log(`[ForumStyles] æˆåŠŸåˆ é™¤è‡ªå®šä¹‰é£æ ¼: ${styleName}`);
        return true;
      } else {
        throw new Error('ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥');
      }
    } catch (error) {
      console.error('[ForumStyles] åˆ é™¤è‡ªå®šä¹‰é£æ ¼å¤±è´¥:', error);
      throw error;
    }
  }

  /**
   * è·å–è‡ªå®šä¹‰é£æ ¼
   */
  getCustomStyle(styleName) {
    return this.customStyles.get(styleName);
  }

  /**
   * è·å–æ‰€æœ‰è‡ªå®šä¹‰é£æ ¼
   */
  getAllCustomStyles() {
    return Array.from(this.customStyles.values());
  }

  /**
   * æ£€æŸ¥æ˜¯å¦æ˜¯è‡ªå®šä¹‰é£æ ¼
   */
  isCustomStyle(styleName) {
    return this.customStyles.has(styleName);
  }

  /**
   * å¯¼å‡ºæ‰€æœ‰è‡ªå®šä¹‰é£æ ¼
   */
  exportCustomStyles() {
    try {
      const exportData = {
        version: '1.0',
        exportTime: new Date().toISOString(),
        styles: Array.from(this.customStyles.values()),
      };

      return JSON.stringify(exportData, null, 2);
    } catch (error) {
      console.error('[ForumStyles] å¯¼å‡ºè‡ªå®šä¹‰é£æ ¼å¤±è´¥:', error);
      throw error;
    }
  }

  /**
   * å¯¼å…¥è‡ªå®šä¹‰é£æ ¼
   */
  importCustomStyles(jsonData, options = {}) {
    try {
      const importData = JSON.parse(jsonData);

      if (!importData.styles || !Array.isArray(importData.styles)) {
        throw new Error('æ— æ•ˆçš„å¯¼å…¥æ•°æ®æ ¼å¼');
      }

      const results = {
        success: 0,
        failed: 0,
        skipped: 0,
        errors: [],
      };

      importData.styles.forEach((style, index) => {
        try {
          // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
          if (this.customStyles.has(style.name) && !options.overwrite) {
            results.skipped++;
            return;
          }

          // éªŒè¯é£æ ¼æ•°æ®
          if (!style.name || !style.prompt) {
            throw new Error('é£æ ¼åç§°å’Œå†…å®¹ä¸èƒ½ä¸ºç©º');
          }

          // é‡æ–°ç”ŸæˆIDå’Œæ—¶é—´æˆ³
          const newStyle = {
            ...style,
            id: 'custom_' + Date.now() + '_' + index,
            updatedAt: new Date().toISOString(),
            isCustom: true,
          };

          this.customStyles.set(newStyle.name, newStyle);
          results.success++;
        } catch (error) {
          results.failed++;
          results.errors.push(`é£æ ¼ "${style.name || 'Unknown'}": ${error.message}`);
        }
      });

      // ä¿å­˜åˆ°localStorage
      if (results.success > 0) {
        this.saveCustomStyles();
      }

      console.log(`[ForumStyles] å¯¼å…¥å®Œæˆ: æˆåŠŸ${results.success}, å¤±è´¥${results.failed}, è·³è¿‡${results.skipped}`);
      return results;
    } catch (error) {
      console.error('[ForumStyles] å¯¼å…¥è‡ªå®šä¹‰é£æ ¼å¤±è´¥:', error);
      throw error;
    }
  }

  /**
   * æ¸…ç©ºæ‰€æœ‰è‡ªå®šä¹‰é£æ ¼
   */
  clearCustomStyles() {
    try {
      this.customStyles.clear();
      localStorage.removeItem('mobile_forum_custom_styles');
      console.log('[ForumStyles] å·²æ¸…ç©ºæ‰€æœ‰è‡ªå®šä¹‰é£æ ¼');
      return true;
    } catch (error) {
      console.error('[ForumStyles] æ¸…ç©ºè‡ªå®šä¹‰é£æ ¼å¤±è´¥:', error);
      return false;
    }
  }
}

// åˆ›å»ºå…¨å±€å®ä¾‹
window.forumStyles = new ForumStyles();

// å¯¼å‡ºç±»
if (typeof module !== 'undefined' && module.exports) {
  module.exports = ForumStyles;
}
